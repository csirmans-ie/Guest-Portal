<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Guest Wi‑Fi Login</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2rem; }
    input, button { padding: 0.5rem; font-size: 1rem; margin: 0.5rem; }
  </style>
</head>
<body>
  <h2>Welcome to Our Guest Wi‑Fi</h2>
  <p>Please enter your email to connect:</p>

  <form id="loginForm">
    <input type="email" id="email" placeholder="you@example.com" required>
    <button type="submit">Connect</button>
  </form>

  <script>
    // 1. Grab Meraki params
    const params = new URLSearchParams(window.location.search);
    const baseGrant  = params.get('base_grant_url');
    const continueTo = params.get('user_continue_url') || 'https://www.google.com';

    // 2. Zapier Webhook URL (replace with YOUR Zap URL)
    const zapWebhook = 'https://hooks.zapier.com/hooks/catch/123456/abcdef/';

    document.getElementById('loginForm').addEventListener('submit', e => {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      if (!email || !baseGrant) {
        alert('Missing email or portal parameter.');
        return;
      }

      // 3. Send data to Zapier
      fetch(zapWebhook, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ email, base_grant_url: baseGrant, user_continue_url: continueTo })
      })
      .then(() => {
        // 4. Redirect back to Meraki to grant access
        window.location.href = `${baseGrant}?continue_url=${encodeURIComponent(continueTo)}`;
      })
      .catch(err => {
        console.error(err);
        alert('Oops! Something went wrong.');
      });
    });
  </script>
</body>
</html>
